{% extends "layout.html" %} {% block body %}

<!-- Firebase Scripts for logout functionality -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<!-- Page Header-->
<header
  class="masthead"
  style="background-image: url('{{url_for('static',filename='assets/img/admin1-bg.jpg')}}')"
>
  <link rel="stylesheet" href="{{url_for('static', filename='css/dasboard.css')}}" />
  <div class="container position-relative px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-md-10 col-lg-8 col-xl-7">
        <div class="post-heading">
          <h1 align="center">Welcome To Admin Panel</h1>
          {% if session.display_name %}
            <p align="center" style="color: white;">Welcome, {{ session.display_name }}!</p>
          {% elif session.user %}
            <p align="center" style="color: white;">Welcome, {{ session.user }}!</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Admin Controls -->
<div style="display: flex; justify-content: space-between; align-items: center; padding: 20px 50px; background-color: #f8f9fa; border-bottom: 1px solid #ddd;">
  <div>
    <h5 style="margin: 0;">Dashboard Controls</h5>
  </div>
  <div style="display: flex; gap: 15px;">
    <button onclick="addBlog()" class="btn btn-primary" style="border-radius: 20px;">Add Blog</button>
    <button onclick="handleLogout()" class="btn btn-danger" style="border-radius: 20px;">Logout</button>
  </div>
</div>
<!-- Post Content-->
<body>
  <h2 align="center">Blog Posts Management</h2>
  <hr />
  <p></p>
  </div>
  <div style="overflow: auto">
    <table style="width: 100%">
      <tr style="background-color: #eee; text-align: center">
        <th style="border: 2px">Title</th>
        <th style="border: 2px">Tagline</th>
        <th style="border: 2px">Content</th>
        <th style="border: 2px">Date</th>
        <th>Edit</th>
        <th>Delete</th>
      </tr>
      {% for post in posts %}
      <tr style="text-align: center">
        <td style="padding: 10px">{{post.title}}</td>
        <td style="padding: 2px">{{post.tagline}}</td>
        <td style="padding: 10px">{{post.content[:50]}}..</td>
        <td style="padding: 10px">{{post.date}}</td>
        <td style="padding: 10px">
          <button style="color: tomato">Edit</button>
        </td>
        <td style="padding: 10px">
          <button style="color: tomato">Delete</button>
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
  <hr />
  <article class="mb-4">
    <div class="container px-4 px-lg-5">
      <div class="row gx-4 gx-lg-5 justify-content-center">
        <div class="col-md-10 col-lg-8 col-xl-7">
          <p>
            Admin Dashboard - Manage your blog posts and content
          </p>
        </div>
      </div>
    </div>
  </article>

<script>
  // Firebase configuration - Replace with your actual config
  const firebaseConfig = {
      apiKey: "your-api-key",
      authDomain: "your-project-id.firebaseapp.com",
      databaseURL: "https://your-project-id-default-rtdb.firebaseio.com",
      projectId: "your-project-id",
      storageBucket: "your-project-id.appspot.com",
      messagingSenderId: "your-sender-id",
      appId: "your-app-id"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  function addBlog() {
      alert('Add blog functionality coming soon!');
      // You can implement blog creation functionality here
  }

  function handleLogout() {
      // Sign out from Firebase if user is logged in via Firebase
      auth.signOut().then(() => {
          console.log('Firebase signout successful');
      }).catch((error) => {
          console.log('Firebase signout error (user might not be logged in via Firebase):', error);
      }).finally(() => {
          // Always redirect to logout route to clear server session
          window.location.href = '/logout';
      });
  }

  // Check authentication status on page load
  document.addEventListener('DOMContentLoaded', function() {
      fetch('/api/auth-status')
          .then(response => response.json())
          .then(data => {
              if (!data.authenticated) {
                  // If not authenticated on server, redirect to login
                  window.location.href = '/login';
              }
          })
          .catch(error => {
              console.error('Error checking auth status:', error);
          });
  });
</script>
</body>
<!-- Footer-->
{% endblock %}
